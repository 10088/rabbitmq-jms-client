#!/bin/bash

echo Reset RabbitMQ server for Integration Tests

if [ -z "${RJMS_RABBITMQ_BASE}" ] ; then
  echo "Couldn't find the RABBITMQ_BASE directory"
  exit 1
fi

sudo ${RJMS_RABBITMQ_BASE}/sbin/rabbitmqctl stop_app
sudo ${RJMS_RABBITMQ_BASE}/sbin/rabbitmqctl reset
# sudo rabbitmq-plugins enable rabbitmq_rjms_topics
sudo ${RJMS_RABBITMQ_BASE}/sbin/rabbitmq-plugins list
sudo ${RJMS_RABBITMQ_BASE}/sbin/rabbitmqctl start_app
sudo ${RJMS_RABBITMQ_BASE}/sbin/rabbitmqctl wait ${RJMS_RABBITMQ_BASE}/var/lib/rabbitmq/mnesia/${RJMS_RABBITMQ_NODENAME}.pid

echo RabbitMQ server reset
